---
description: 
globs: 
alwaysApply: true
---
# Deployment Workflow

## Development Environment (Personal Work Computer)
- Primary development and code changes happen here
- Changes are committed and pushed to GitHub
- Local database is used for development and testing
- Environment variables should be configured for local development

## Production Environment (Lab PC)
- Acts as the production server hosting the Streamlit app
- Pulls changes from GitHub to update the application
- Maintains the production database
- Runs automated backups and public database copies
- Environment variables should be configured for production

## Database Management
- Lab PC maintains the production database (experiments.db)
- Personal computer uses a separate development database
- Never directly modify the production database on the lab PC
- All database changes must go through migrations

## Backup Strategy
- Lab PC runs automated backups every 48 hours
- Public database copies are created every 12 hours
- Backup location is configured via BACKUP_DIRECTORY environment variable
- Public copy location is configured via PUBLIC_DATABASE environment variable

## Deployment Process (Automated)
The Lab PC uses `auto_update.bat` to automatically pull, migrate, and restart.

1. Make changes on personal work computer
2. Test changes locally (including database migrations)
3. Commit and push to GitHub
4. Lab PC auto-updater detects the new commit(s) and:
   a. Creates a timestamped database backup via `utils/database_backup.py`
   b. Pulls changes from origin/main
   c. Installs any new dependencies from requirements.txt
   d. Runs `alembic upgrade head`
   e. Restarts the Streamlit application
   f. On failure: rolls back git and restores the database backup

### Auto-Updater Setup on Lab PC
- **Polling mode:** Run `auto_update.bat --poll` to check every 5 minutes
- **Task Scheduler:** Schedule `auto_update.bat` (no args) to run every N minutes
- **Manual trigger:** Run `auto_update.bat` once to check and update immediately
- **Restart only:** Run `auto_update.bat --restart-only` to restart Streamlit
- **Logs:** Check `logs/auto_updater.log` for update history and errors

### Auto-Updater Files
- `utils/auto_updater.py` — Core update logic (backup, pull, migrate, restart, rollback)
- `auto_update.bat` — Windows batch launcher for the auto-updater

## Environment Variables
- Keep sensitive configuration in environment variables
- Use different .env files for development and production
- Never commit .env files to GitHub
- Document required environment variables in README.md

## Important Notes
- Always pull latest changes before starting new development
- Test database migrations locally before deploying
- Keep backup and public copy locations synchronized between environments
- Monitor `logs/auto_updater.log` for update and backup issues
- The auto-updater will refuse to update if there are uncommitted local changes on the Lab PC
- A file lock (`.update_lock`) prevents concurrent update processes
- I am using cursor from my personal PC, command line tool requests can not be run on Lab PC. Write them out for me to run in Git Bash on Lab PC.

